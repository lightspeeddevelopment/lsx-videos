var conduitApp={},coduitTemplates={},conduitRegisterApps,conduitModal,conduitModalSave,conduitGenID,conduitSaveObject,conduitGetData;!jQuery(function(a){var t=null;conduitException=function(a){this.message=a,this.name="ConduitException"},a.fn.conduitTrigger=function(t){var i={method:"GET",url:ajaxurl};return a.extend(!0,i,t),a.ajax(i).success(function(){}),this},a.fn.getObject=function(){for(var t=a(this),i=t.find("[name]"),e={},n={},o=0;o<i.length;o++){var d=a(i[o]),c=d.prop("name").replace(/\]/gi,"").split("["),r=d.val(),u={};if(!d.is(":radio")&&!d.is(":checkbox")||d.is(":checked")){if(d.prop("required")&&!d.val().length)throw d.focus(),new conduitException("requiredfield");for(var p=c.length-1;p>=0;p--){var l=c[p];if("undefined"==typeof l&&(l=""),0===l.length&&(u=[],"undefined"==typeof n[c[p-1]]?n[c[p-1]]=0:n[c[p-1]]+=1,l=n[c[p-1]]),p===c.length-1){if(r)if("true"===r)r=!0;else if("false"===r)r=!1;else if(isNaN(parseFloat(r))||parseFloat(r).toString()!==r){if("string"==typeof r&&("{"===r.substr(0,1)||"["===r.substr(0,1)))try{r=JSON.parse(r)}catch(s){}}else r=parseFloat(r);u[l]=r}else{var f=u;u={},u[l]=f}}a.extend(!0,e,u)}}return e},conduitGeneralBaldrick=function(){a(".wp-trigger").conduitTrigger({method:"POST",before:function(t){var i=a(t),e=i.closest("[data-app]");e.length?i.data("data",JSON.stringify(conduitBuildData(e.data("app")))):i.data("data")&&i.data("data",JSON.stringify(conduitBuildData(i.data("data"))))}})},conduitSaveObject=function(i){var e;e=!0===i?conduitPrepObject():conduitPrepObject(i);var n={action:uix.slug+"_save_config",uix_setup:a("#uix_setup").val(),page_slug:uix.page_slug,config:JSON.stringify(e),autosave:!0};uix.save_params&&(n.params=uix.save_params),a(window).trigger("uix.saving"),t&&t.abort(),t=a.post(ajaxurl,n,function(i){a(window).trigger("uix.saved"),t=null})},conduitPrepObject=function(){var a={};for(var t in conduitApp)conduitApp[t].app&&(conduitApp[t].app.is(":visible")?a[t]=conduitBuildData(t):a[t]=conduitApp[t].data);return a},conduitModalFooter=function(t){var i,e=t.buttons?t.buttons.split(" "):["save"],n=t.modal.split("."),o=t.app?t.app:t.trigger.closest("[data-app]").data("app"),d={__node_path:n.join(".")},c="";d.__app=o,t.trigger.data("before")&&(d.__before=t.trigger.data("before")),t.trigger.data("callback")&&(d.__callback=t.trigger.data("callback"));for(var r=0;r<e.length;r++)c+=a("#__partial_"+e[r]).length?a("#__partial_"+e[r]).html():"";return(i=Handlebars.compile(c,{data:!0}))(d)},conduitModal=function(a,t){var i=a.modal.split("."),e=a.app?a.app:a.trigger.closest("[data-app]").data("app"),n=a["default"]?a["default"]:null,o=Handlebars.compile('<div data-app="'+a.template+'">{{> '+a.template+"}}</div>",{data:!0});if(data={},conduitBuildData(e),conduitApp[e]){var d=conduitApp[e].data;if(null!==n)data=n;else{for(var c=0;c<i.length;c++)d=d[i[c]]?d[i[c]]:{};data=d}}return data.__node_path=a.points,data.__app=e,conduitApp[a.template]={app:t.content,data:data},coduitTemplates[a.template]=o,o(data)},conduitGetData=function(a){var t=a.trigger.data("app"),i={};return conduitApp[t]&&conduitApp[t].data?conduitApp[t].data:i},conduitBuildData=function(a){if(conduitApp[a]&&conduitApp[a].app)try{conduitApp[a].data=conduitApp[a].app.getObject()}catch(t){return!1}return conduitApp[a].data},conduitSyncData=function(a){conduitBuildData(a),conduitBuildUI(a)},conduitRegisterApps=function(){var t=a("[data-app]").not("._bound_app");if(t.length&&(t.each(function(){var t=a(this),i=t.data("app");conduitApp[i]={app:t,data:uix.config[i]?uix.config[i]:{}},t.addClass("_bound_app"),conduitBuildUI(i)}),uix.tabs))for(var i in uix.tabs)if(uix.tabs[i]["default"]){a('[data-tab="'+i+'"]').trigger("click");break}},conduitBuildUI=function(t){if(conduitApp[t]){var i=conduitApp[t].data;i._tab={};for(var e in conduitApp)e!==t&&(i._tab[e]=conduitApp[e].data);conduitApp[t].app.html(coduitTemplates[t](i))}a(window).trigger("uix.init"),a(window).trigger("modal.init")},conduitSetNode=function(t,i,e){for(var n=t.split("."),o='{ "'+n.join('": { "')+'" : null',d=0;d<n.length;d++)o+="}";var c=JSON.parse(o);a.extend(!0,conduitApp[i].data,c);for(var o='{ "'+n.join('": { "')+'" : '+JSON.stringify(e),d=0;d<n.length;d++)o+="}";var c=JSON.parse(o);a.extend(!0,conduitApp[i].data,c),conduitBuildUI(i)},conduitGenID=function(){var a=(new Date).getTime(),t="ndxxxxxxxx".replace(/[xy]/g,function(t){var i=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==t?i:3&i|8).toString(16)});return t},conduitAddNode=function(t,i,e){var n=conduitGenID(),o=t.data?t.data("addNode").split("."):t.split("."),d=e?e:t.data("nodeDefault"),c=o.join(".")+"."+n,r=JSON.parse('{ "_id" : "'+n+'", "_node_point" : "'+c+'" }');d&&"object"==typeof d&&a.extend(!0,r,d);for(var u='{ "'+o.join('": { "')+'" : { "'+n+'" : '+JSON.stringify(r),p=0;p<=o.length;p++)u+="}";var l=JSON.parse(u);conduitBuildData(i),a.extend(!0,conduitApp[i].data,l),conduitBuildUI(i)},a(document).on("click",".cf-reports-card-actions .confirm a",function(t){t.preventDefault();var i=a(this).closest(".cf-reports-card-content");actions=i.find(".row-actions"),actions.slideToggle(300)}),a(document).on("keyup change",'[data-format="slug"]',function(t){var i=a(this);return i.data("master")&&i.prop("required")&&this.value.length<=0&&"change"===t.type?(this.value=a(i.data("master")).val().replace(/[^a-z0-9]/gi,"_").toLowerCase(),void(this.value.length&&i.trigger("change"))):void(this.value=this.value.replace(/[^a-z0-9]/gi,"_").toLowerCase())}),a(document).on("keyup change","[data-sync]",function(){var t=a(this),i=a(t.data("sync"));i.each(function(){var i=a(this);i.is("input")?i.val(t.val()).trigger("change"):i.text(t.val())})}),a(document).on("click","[data-add-node]",function(t){var i=a(this),e=i.closest("[data-app]").data("app");e&&"object"==typeof conduitApp[e]&&(t.preventDefault(),conduitAddNode(i,e))}),a(document).on("click","[data-remove-element]",function(t){var i=a(this),e=i.closest("[data-app]").data("app"),n=a(i.data("removeElement"));i.data("confirm")&&!confirm(i.data("confirm"))||(n.remove(),conduitSyncData(e))}),a(document).on("click","[data-save-object]",function(t){t.preventDefault();var i,e=a(this),n=a(this).data("saveObject"),o=a(".page-title-action .spinner"),d=a(".uix-sub-nav");a(".uix-notice .notice-dismiss").trigger("click"),i=!0===n?conduitPrepObject():conduitPrepObject(n),e.addClass("saving"),o.slideDown(100);var c={action:uix.slug+"_save_config",uix_setup:a("#uix_setup").val(),page_slug:uix.page_slug,config:JSON.stringify(i)};uix.save_params&&(c.params=uix.save_params),a.post(ajaxurl,c,function(t){o.slideUp(100),e.removeClass("saving");var i=a(coduitTemplates.__notice(t));i.hide().insertAfter(d).slideDown(200),a(window).trigger("uix.saved")})}),a(document).on("change","[data-live-sync]",function(t){var i=a(this).closest("[data-app]").data("app");conduitSyncData(i)}),a(document).on("click","button[data-live-sync]",function(t){var i=a(this).closest("[data-app]").data("app");conduitSyncData(i)}),a(document).on("click",".uix-notice .notice-dismiss",function(){var t=a(this).closest(".uix-notice");t.slideUp(200,function(){t.remove()})}),a(document).on("click","[data-tab]",function(t){t.preventDefault();var i=a(this),e=i.data("tab"),n=a(".active[data-tab]").data("tab");if(n){if(conduitBuildData(n),n===e)return;a('[data-app="'+n+'"]').empty().hide()}a("[data-tab]").removeClass("active"),a('[data-app="'+e+'"]').show(),i.addClass("active"),conduitBuildUI(e)}),a("script[data-template]").each(function(){var t=a(this),i=t.data("template");coduitTemplates[i]=Handlebars.compile(t.html(),{data:!0})}),a("script[data-handlebars-partial]").each(function(){var t=a(this);Handlebars.registerPartial(t.data("handlebarsPartial"),t.html())}),a(document).on("click","[data-modal-node]",function(t){var i,e=a(this),n=e.data("modal-node").split("."),o=e.data("app")?e.data("app"):n.shift(),d=e.data("type")?e.data("type"):"save";if(e.data("before")&&("function"==typeof e.data("before")?e.data("before")(e):"function"==typeof window[e.data("before")]&&window[e.data("before")](e)),"delete"!==d)try{i=e.closest(".uix-modal-wrap").getObject()}catch(t){return}if("add"===d)conduitAddNode(n.join("."),o,i);else if("delete"===d){var c=n.shift();n.length&&(c+="["+n.join("][")+"]"),a('[name^="'+c+'"]').remove(),conduitBuildData(o),conduitBuildUI(o)}else conduitSetNode(n.join("."),o,i);a(window).trigger("close.modal"),e.data("callback")&&("function"==typeof e.data("callback")?e.data("callback")(i,e):"function"==typeof window[e.data("callback")]&&window[e.data("callback")](i,e))}),a(window).on("close.modal",function(t){var i=a(".active[data-tab]").data("tab");i&&conduitBuildUI(i)}),conduitRegisterApps(),window.onbeforeunload=function(){return t?!1:void 0}});